(()=>{"use strict";function e(){const e=document.getElementsByClassName("ticket");Array.from(e).forEach((e=>e.addEventListener("click",(e=>function(e){const t=e.target.closest(".ticket").querySelector(".ticket-description");e.target.classList.contains("btn")||e.target.classList.contains("ticket-checkbox")||!t.textContent||(t.classList.contains("hide-description")?(t.classList.remove("hide-description"),t.classList.add("show-description")):t.classList.contains("show-description")?(t.classList.remove("show-description"),t.classList.add("hide-description")):t.classList.add("show-description"))}(e)))))}function t(){Array.from(document.querySelectorAll(".edit-btn")).forEach((e=>e.addEventListener("click",(e=>function(e){const t=document.querySelector(".edit-ticket-form");t.classList.remove("hide-form"),document.querySelector(".update-title").focus();const c=e.target.parentElement.parentElement,n=c.querySelector(".ticket-title"),i=c.querySelector(".ticket-description"),o=c.id,r=document.querySelector(".update-title");r.value=n.textContent;const d=document.querySelector(".update-description");d.value=i.textContent,t.addEventListener("submit",(e=>{if(e.preventDefault(),r.value!==n||d.value!==i&&!r.value.trim()){n.textContent=r.value,i.textContent=d.value;const e={name:r.value,description:d.value};fetch(`https://backend-rh9i.onrender.com/?method=updateById&id=${o}`,{method:"POST",body:JSON.stringify(e)}).then((()=>{t.classList.add("hide-form")}))}}))}(e)))))}function c(){Array.from(document.querySelectorAll(".remove-btn")).forEach((e=>e.addEventListener("click",(e=>function(e){const t=e.target.parentElement.parentElement,c=document.querySelector(".remove-ticket-form");c.classList.remove("hide-form"),c.addEventListener("submit",(e=>{e.preventDefault();let n=new XMLHttpRequest;n.open("GET",`https://backend-rh9i.onrender.com/?method=deleteById&id=${t.id}`),n.send(),n.addEventListener("load",(()=>{t.remove(),c.classList.add("hide-form")}))}))}(e)))))}document.body.addEventListener("mousedown",(e=>{e.target.classList.contains("form-field")||e.preventDefault()})),document.addEventListener("DOMContentLoaded",void fetch("https://backend-rh9i.onrender.com/?method=allTickets").then((e=>e.json())).then((e=>{e.forEach((e=>{let t=document.createElement("div");t.classList.add("ticket"),t.innerHTML='\n                    <input type="checkbox" class="ticket-checkbox">\n                    <div class="ticket-text-content">\n                        <div class="ticket-title"></div>\n                        <div class="ticket-description"></div>  \n                    </div>\n                    <div class="ticket-date"></div>\n                    <div class="ticket-btns">\n                    <div class="btn edit-btn">&#10000;</div>\n                    <div class="btn remove-btn">&#x2715;</div>\n                    </div>\n                ',t.querySelector(".ticket-title").textContent=e.name.trim(),t.querySelector(".ticket-description").textContent=e.description.trim();const c=t.querySelector(".ticket-date"),n=e.created,i=new Date(n).toLocaleString();c.textContent=i;const o=t.querySelector(".ticket-checkbox");console.log(e),!0===e.status&&(o.checked=!0),t.setAttribute("id",e.id),document.querySelector("#ticket-box").appendChild(t)}))})).then((()=>{e(),document.querySelectorAll(".cancel-btn").forEach((e=>e.addEventListener("click",(e=>{e.target.parentElement.parentElement.classList.add("hide-form");const t=e.target.closest(".ticket-form");(t.classList.contains("add-ticket-form")||t.classlist.contains("edit-ticket-form"))&&Array.from(t.querySelectorAll(".form-field")).forEach((e=>e.value=""))})))),t(),Array.from(document.querySelectorAll(".ticket-checkbox")).forEach((e=>e.addEventListener("click",(e=>function(e){const t=e.target.checked;console.log(t);const c=e.target.parentElement.id,n={status:t};fetch(`https://backend-rh9i.onrender.com/?method=updateById&id=${c}`,{method:"POST",body:JSON.stringify(n)})}(e))))),c()}))),document.querySelector(".add-ticket-btn").addEventListener("click",(()=>{document.querySelector(".ticket-form").classList.remove("hide-form"),document.querySelector(".new-title").focus()})),document.querySelector(".add-ticket-form").addEventListener("submit",(n=>{!function(n){if(n.preventDefault(),document.querySelector(".new-title").value.trim()){const n={name:document.querySelector(".new-title").value,description:document.querySelector(".new-description").value};fetch("https://backend-rh9i.onrender.com/?method=createTicket",{method:"POST",body:JSON.stringify(n)}).then((e=>e.json())).then((n=>{const i=document.createElement("div");i.classList.add("ticket"),i.innerHTML='\n        <input type="checkbox" class="ticket-checkbox">\n        <div class="ticket-text-content">\n          <div class="ticket-title"></div>\n          <div class="ticket-description"></div>  \n        </div>\n        <div class="ticket-date"></div>\n        <div class="ticket-btns">\n          <div class="btn edit-btn">&#10000;</div>\n          <div class="btn remove-btn">&#x2715;</div>\n        </div>',i.id=n.id,i.querySelector(".ticket-title").textContent=n.name,i.querySelector(".ticket-description").textContent=n.description;const o=i.querySelector(".ticket-date"),r=new Date(n.created).toLocaleString();o.textContent=r,document.querySelector("#ticket-box").appendChild(i),document.querySelector(".add-ticket-form").classList.add("hide-form"),e(),t(),c()}))}else alert("Форма не заполнена!")}(n);const i=n.target;Array.from(i.querySelectorAll(".form-field")).forEach((e=>e.value=""))}))})();