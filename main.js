(()=>{"use strict";function e(){Array.from(document.querySelectorAll(".edit-btn")).forEach((e=>e.addEventListener("click",(e=>function(e){const t=document.querySelector(".edit-ticket-form");t.classList.remove("hide-form"),document.querySelector(".update-title").focus();const n=e.target.parentElement.parentElement,c=n.querySelector(".ticket-title"),i=n.querySelector(".ticket-description"),o=n.id,d=document.querySelector(".update-title");d.value=c.textContent;const r=document.querySelector(".update-description");r.value=i.textContent,t.addEventListener("submit",(e=>{if(e.preventDefault(),d.value!==c||r.value!==i&&!d.value.trim()){c.textContent=d.value,i.textContent=r.value;const e={name:d.value,description:r.value};fetch(`https://backend-rh9i.onrender.com/?method=updateById&id=${o}`,{method:"POST",body:JSON.stringify(e)}).then((()=>{t.classList.add("hide-form")}))}}))}(e)))))}function t(){Array.from(document.querySelectorAll(".remove-btn")).forEach((e=>e.addEventListener("click",(e=>function(e){const t=e.target.parentElement.parentElement,n=document.querySelector(".remove-ticket-form");n.classList.remove("hide-form"),n.addEventListener("submit",(e=>{e.preventDefault();let c=new XMLHttpRequest;c.open("GET",`https://backend-rh9i.onrender.com/?method=deleteById&id=${t.id}`),c.send(),c.addEventListener("load",(()=>{t.remove(),n.classList.add("hide-form")}))}))}(e)))))}document.body.addEventListener("mousedown",(e=>{e.target.classList.contains("form-field")||e.preventDefault()})),document.addEventListener("DOMContentLoaded",void fetch("https://backend-rh9i.onrender.com/?method=allTickets").then((e=>e.json())).then((e=>{e.forEach((e=>{let t=document.createElement("div");t.classList.add("ticket"),t.innerHTML='\n                    <input type="checkbox" class="ticket-checkbox">\n                    <div class="ticket-text-content">\n                        <div class="ticket-title"></div>\n                        <div class="ticket-description"></div>  \n                    </div>\n                    <div class="ticket-date"></div>\n                    <div class="ticket-btns">\n                    <div class="btn edit-btn">&#10000;</div>\n                    <div class="btn remove-btn">&#x2715;</div>\n                    </div>\n                ',t.querySelector(".ticket-title").textContent=e.name.trim(),t.querySelector(".ticket-description").textContent=e.description.trim();const n=t.querySelector(".ticket-date"),c=e.created,i=new Date(c).toLocaleString();n.textContent=i;const o=t.querySelector(".ticket-checkbox");console.log(e),!0===e.status&&(o.checked=!0),t.setAttribute("id",e.id),document.querySelector("#ticket-box").appendChild(t)}))})).then((()=>{!function(){const e=document.getElementsByClassName("ticket");Array.from(e).forEach((e=>e.addEventListener("click",(e=>function(e){const t=e.target.closest(".ticket").querySelector(".ticket-description");e.target.classList.contains("btn")||e.target.classList.contains("ticket-checkbox")||!t.textContent||(t.classList.contains("hide-description")?(t.classList.remove("hide-description"),t.classList.add("show-description")):t.classList.contains("show-description")?(t.classList.remove("show-description"),t.classList.add("hide-description")):t.classList.add("show-description"))}(e)))))}(),document.querySelectorAll(".cancel-btn").forEach((e=>e.addEventListener("click",(e=>{e.target.parentElement.parentElement.classList.add("hide-form")})))),e(),Array.from(document.querySelectorAll(".ticket-checkbox")).forEach((e=>e.addEventListener("click",(e=>function(e){const t=e.target.checked;console.log(t);const n=e.target.parentElement.id,c={status:t};fetch(`https://backend-rh9i.onrender.com/?method=updateById&id=${n}`,{method:"POST",body:JSON.stringify(c)})}(e))))),t()}))),document.querySelector(".add-ticket-btn").addEventListener("click",(()=>{document.querySelector(".ticket-form").classList.remove("hide-form"),document.querySelector(".new-title").focus()})),document.querySelector(".add-ticket-form").addEventListener("submit",(n=>function(n){if(n.preventDefault(),document.querySelector(".new-title").value.trim()){const n={name:document.querySelector(".new-title").value,description:document.querySelector(".new-description").value};fetch("https://backend-rh9i.onrender.com/?method=createTicket",{method:"POST",body:JSON.stringify(n)}).then((e=>e.json())).then((n=>{const c=document.createElement("div");c.classList.add("ticket"),c.innerHTML='\n        <input type="checkbox" class="ticket-checkbox">\n        <div class="ticket-text-content">\n          <div class="ticket-title"></div>\n          <div class="ticket-description"></div>  \n        </div>\n        <div class="ticket-date"></div>\n        <div class="ticket-btns">\n          <div class="btn edit-btn">&#10000;</div>\n          <div class="btn remove-btn">&#x2715;</div>\n        </div>',c.id=n.id,c.querySelector(".ticket-title").textContent=n.name,c.querySelector(".ticket-description").textContent=n.description;const i=c.querySelector(".ticket-date"),o=new Date(n.created).toLocaleString();i.textContent=o,document.querySelector("#ticket-box").appendChild(c),document.querySelector(".add-ticket-form").classList.add("hide-form"),e(),t()}))}else alert("Форма не заполнена!")}(n)))})();